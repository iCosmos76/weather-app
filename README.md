# Мониторинг погодного микросервиса (Python/Flask)

### Prerequirements

1. Установленный **Docker** и **Docker Compose**.
2. Ваш пользователь должен быть добавлен в группу `docker`, чтобы избежать необходимости использовать `sudo`.

### Шаги запуска

1. **Клонируйте репозиторий:**

```bash
git clone <ссылка_на_репозиторий>
cd weather-app
```

2. **API-ключ:**
    создайте файл **`.env`** в корне проекта (он игнорируется Git'ом) для безопасного хранения ключа:

```bash
# .env
WEATHER_API_KEY=<приватный_ключ>
```
Сам ключ можно найти на сайте `https://openweathermap.org/` после регистрации: **Имя пользователя (справа сверху) -> My API keys**

3. **Запуск приложения:**
    используйте Docker Compose для сборки образа приложения, установки Prometheus и Grafana, а также их запуска в фоновом режиме (`-d`).

```bash
docker-compose up -d --build
```

---

## Проверка работоспособности и мониторинг

После успешного запуска все сервисы будут доступны по следующим адресам:

### 1. Приложение

* **URL:** `http://localhost:5000/`
* **Проверка доступности (Health Check):** `http://localhost:5000/health`
* **Проверка метрик:** `http://localhost:5000/metrics` (Данные для Prometheus)

### 2. Prometheus

* **URL:** `http://localhost:9090`
* **Проверка целей (Targets):** Перейдите в **Status -> Targets**. Сервис `weather-app:5000` должен быть в статусе **`UP`** (зеленый).

### 3. Grafana

* **URL:** `http://localhost:3000`
* **Логин/Пароль:** `admin` / `admin` (при первом входе)

После входа в Grafana, необходимо подключить ее к Prometheus для получения метрик.

1) в меню слева выберите Connections (или иконку шестеренки) -> Data Sources;
2) нажмите Add data source;
3) выберите Prometheus;
4) в поле Prometheus server URL введите: `http://localhost:3000`.

Далее, перейдите в **Dashboards → New → Import** и импортируйте json модель из файла grafana_dashboard.json.

Для появления данных на дашборде обновите страницу приложения `http://localhost:5000/` несколько раз, чтобы сгенерировать HTTP-запросы.

### Основные метрики Grafana

* **Request Duration:** Как долго отвечает ваше приложение.
* **Requests per Second:** Нагрузка на приложение.
* **Status Codes:** График успешных (200) и ошибочных (500) ответов.

---

## Остановка проекта

Для остановки и удаления всех запущенных контейнеров и созданной сети:

```bash
docker-compose down
```

Фото работы приложения в находятся в папке **screenshots**.
